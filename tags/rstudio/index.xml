<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Rstudio on R &amp; Python Blog</title><link>https://csc-ubc-okanagan.github.io/csc-data-blog/tags/rstudio/</link><description>Recent content in Rstudio on R &amp; Python Blog</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><copyright>Center for Scholarly Communication, UBC Okanagan</copyright><lastBuildDate>Fri, 14 Feb 2025 00:00:00 +0000</lastBuildDate><atom:link href="https://csc-ubc-okanagan.github.io/csc-data-blog/tags/rstudio/index.xml" rel="self" type="application/rss+xml"/><item><title>Abacus API</title><link>https://csc-ubc-okanagan.github.io/csc-data-blog/p/abacus-api/</link><pubDate>Fri, 14 Feb 2025 00:00:00 +0000</pubDate><guid>https://csc-ubc-okanagan.github.io/csc-data-blog/p/abacus-api/</guid><description>&lt;script src="https://csc-ubc-okanagan.github.io/csc-data-blog/p/abacus-api/index.en_files/kePrint/kePrint.js">&lt;/script>
&lt;link href="https://csc-ubc-okanagan.github.io/csc-data-blog/p/abacus-api/index.en_files/lightable/lightable.css" rel="stylesheet" />
&lt;script src="https://csc-ubc-okanagan.github.io/csc-data-blog/p/abacus-api/index.en_files/kePrint/kePrint.js">&lt;/script>
&lt;link href="https://csc-ubc-okanagan.github.io/csc-data-blog/p/abacus-api/index.en_files/lightable/lightable.css" rel="stylesheet" />
&lt;script src="https://csc-ubc-okanagan.github.io/csc-data-blog/p/abacus-api/index.en_files/kePrint/kePrint.js">&lt;/script>
&lt;link href="https://csc-ubc-okanagan.github.io/csc-data-blog/p/abacus-api/index.en_files/lightable/lightable.css" rel="stylesheet" />
&lt;script src="https://csc-ubc-okanagan.github.io/csc-data-blog/p/abacus-api/index.en_files/kePrint/kePrint.js">&lt;/script>
&lt;link href="https://csc-ubc-okanagan.github.io/csc-data-blog/p/abacus-api/index.en_files/lightable/lightable.css" rel="stylesheet" />
&lt;script src="https://csc-ubc-okanagan.github.io/csc-data-blog/p/abacus-api/index.en_files/kePrint/kePrint.js">&lt;/script>
&lt;link href="https://csc-ubc-okanagan.github.io/csc-data-blog/p/abacus-api/index.en_files/lightable/lightable.css" rel="stylesheet" />
&lt;h2 id="definitions">Definitions
&lt;/h2>&lt;p>&lt;strong>API&lt;/strong>&lt;/p>
&lt;p>An application programming interface (API) is a formalized way of interacting with another piece of hardware or software without needing to know how that hardware or software actually works. As such, it is a convenient method of making requests to get, update, or push information between your system and the remote system. As a loose analogy, you can think of this as a menu in a resuraunt; you don&amp;rsquo;t need to know how the kitchen makes your food, but you need to know what you can ask for from your server. When you want scrambled eggs, you don&amp;rsquo;t need to go into the kitchen and make these from scratch, you simply put in a request based on the options on the menu.&lt;/p>
&lt;p>&lt;strong>JSON&lt;/strong>&lt;/p>
&lt;p>JavaScript Object Notation (JSON) is a method for storing and transmitting data primarily using key value pairs. It is compact, flexible, human readable, and works well in a Web based environment. It is generally the default format in which data is transmitted from an API.&lt;/p>
&lt;h2 id="set-up">Set up
&lt;/h2>&lt;p>The Abacus API is accessible through http, which means we can access the API using any http compliant tool, including a web browser.&lt;/p>
&lt;p>By default, the API returns data in JSON notation. One of the issues we have when working in &lt;code>R&lt;/code> is that &lt;code>R&lt;/code> excels with rectangular data, especially if working in the &lt;code>Tidyverse&lt;/code>. So we need to wrangle the JSON formatted data into a data structure more amenable to R. This begins by moving content into a list after which we can transition it to a dataframe, or tibble, as needed.&lt;/p>
&lt;p>To do this all, we&amp;rsquo;ll use the following four libraries, although, as we&amp;rsquo;ll see later, we can get away with just the &lt;code>httr2&lt;/code> package:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="nf">library&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">httr2&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># http protocols&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">library&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">jsonlite&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># json to r data structures&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="steps">Steps
&lt;/h2>&lt;p>In the proceding sections we&amp;rsquo;ll cover the following steps:&lt;/p>
&lt;ol>
&lt;li>Using the &lt;code>search&lt;/code> API to look for relevant datasets.&lt;/li>
&lt;li>Plugging a unique ID associated with the dataset(s) of interest into the &lt;code>datasets&lt;/code> api to identify the files of interest. This involves first identifying a new unique ID for each dataset, only accessible through the &lt;code>datasets&lt;/code> API, and the version of the dataset we&amp;rsquo;re interested in (an Abacus record is version controlled).&lt;/li>
&lt;li>We will then use the urls associated with the data files to download the relevant data.&lt;/li>
&lt;/ol>
&lt;p>We will be working with the Statistics Canada Labour Force Surveys for this exercise.&lt;/p>
&lt;h2 id="caveats">Caveats
&lt;/h2>&lt;p>This is a simplified overview of API interactions. So, for example, we will not be doing any error handling, nor will we deal with using authentication tokens. But these are easily built in once the general approach is understood, and the &lt;code>httr2&lt;/code> package has functions for handling these things.&lt;/p>
&lt;h2 id="building-the-connection">Building the Connection
&lt;/h2>&lt;p>Abacus is built on a Dataverse instance. You can &lt;a class="link" href="https://guides.dataverse.org/en/latest/api/index.html" target="_blank" rel="noopener"
>refer to the Dataverse API documentation&lt;/a> for more information on interacting with the API.&lt;/p>
&lt;p>Abacus has more than one API. This is common when interacting with APIs. Each API gives you access to certain functionalities and returns certain pieces of data. Here, we&amp;rsquo;ll review the &lt;code>search&lt;/code> and &lt;code>datasets&lt;/code> APIs; the former to locate content, the latter to retrieve that content. We will ultimately use the &lt;code>access&lt;/code> API with &lt;code>download.file()&lt;/code> to acquire the data.&lt;/p>
&lt;p>In either case, we start with the base url into the API, which we&amp;rsquo;ll store in a variable.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">base_url&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="s">&amp;#34;https://abacus.library.ubc.ca/api/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Next, we can add on the specific API we intend to search.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">search_api&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="s">&amp;#34;search?q=&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The &lt;code>search&lt;/code> API requires a &lt;code>query&lt;/code> parameter, ie, something to search for. This is articulated as a string, following the &lt;code>?q=&lt;/code>.&lt;/p>
&lt;p>Note: When using the &lt;code>httr2&lt;/code> package, if the query string is multi-word, spaces need to be filled with &lt;code>%20&lt;/code>. For example, a search for &lt;code>labour force&lt;/code> will fail, and need to be replaced with &lt;code>labour%20force&lt;/code>.&lt;/p>
&lt;h2 id="search-api">Search API
&lt;/h2>&lt;p>There are a variety of fields and file types that we can search through the search API, noting that, as a data repository, objects in Abacus are organized into dataverses, datasets, and files, where datasets reside in dataverses, and files within datasets. Datasets provide a high level overview of the data they hold, including descriptions, number of files, who produced the files, when they were uploaded, etc.&lt;/p>
&lt;p>We&amp;rsquo;ve already built our &lt;code>base_url&lt;/code> and added on the requisite text to access the &lt;code>search&lt;/code> API, &lt;code>search_api&lt;/code>. We&amp;rsquo;ll now build our query, specifying the query and the file type of interest, ie, do we want to search for a dataverse, dataset, or file.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">search_query&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="s">&amp;#34;title:labour&amp;#34;&lt;/span> &lt;span class="c1"># retrieve everything with the word labour in the title&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">search_type&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="s">&amp;#34;&amp;amp;type=dataset&amp;#34;&lt;/span> &lt;span class="c1"># limit to datasets&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>We can then paste these together to construct a full query.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="n">search_api_call&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">paste0&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">base_url&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">search_api&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">search_query&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">search_type&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;https://abacus.library.ubc.ca/api/search?q=title:labour&amp;amp;type=dataset&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>To get a sense of what this looks like, we can load this query in our browser.&lt;/p>
&lt;h2 id="implementing-the-search-in-r">Implementing the Search in &lt;code>R&lt;/code>
&lt;/h2>&lt;p>The &lt;code>hhtr2&lt;/code> package will allow us to make http requests from within &lt;code>R&lt;/code>. The steps involved including:&lt;/p>
&lt;p>a) building a request; and then
b) performing that request, which results in some data being sent back to us.&lt;/p>
&lt;p>These two steps are done, respectively, with the &lt;code>request()&lt;/code> and &lt;code>req_perform()&lt;/code> functions. We feed our &lt;code>search_api_call&lt;/code> into the &lt;code>request()&lt;/code> and then feed the result into the &lt;code>req_preform&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">search_resp&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">search_api_call&lt;/span> &lt;span class="o">|&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">httr2&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="nf">request&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">|&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">httr2&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="nf">req_perform&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>What we get back is the same as what we saw in our browser, formatted as a list.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="nf">str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">search_resp&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## List of 7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## $ method : chr &amp;#34;GET&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## $ url : chr &amp;#34;https://abacus.library.ubc.ca/api/search?q=title:labour&amp;amp;type=dataset&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## $ status_code: int 200
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## $ headers :List of 8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## ..$ Date : chr &amp;#34;Mon, 24 Mar 2025 22:32:17 GMT&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## ..$ Server : chr &amp;#34;Apache/2.4.37 (Red Hat Enterprise Linux) OpenSSL/1.1.1k mod_R/1.2.9 R/3.5.0 mod_apreq2-20101207/2.8.1&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## ..$ X-Frame-Options : chr &amp;#34;SAMEORIGIN&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## ..$ Access-Control-Allow-Origin : chr &amp;#34;*&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## ..$ Access-Control-Allow-Methods: chr &amp;#34;PUT, GET, POST, DELETE, OPTIONS&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## ..$ Access-Control-Allow-Headers: chr &amp;#34;Accept, Content-Type, X-Dataverse-Key&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## ..$ Content-Type : chr &amp;#34;application/json;charset=UTF-8&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## ..$ Transfer-Encoding : chr &amp;#34;chunked&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## ..- attr(*, &amp;#34;class&amp;#34;)= chr &amp;#34;httr2_headers&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## $ body : raw [1:24871] 7b 22 73 74 ...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## $ request :List of 7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## ..$ url : chr &amp;#34;https://abacus.library.ubc.ca/api/search?q=title:labour&amp;amp;type=dataset&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## ..$ method : NULL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## ..$ headers : list()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## ..$ body : NULL
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## ..$ fields : list()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## ..$ options : list()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## ..$ policies: list()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## ..- attr(*, &amp;#34;class&amp;#34;)= chr &amp;#34;httr2_request&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## $ cache :&amp;lt;environment: 0x13d5a1990&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## - attr(*, &amp;#34;class&amp;#34;)= chr &amp;#34;httr2_response&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>What we&amp;rsquo;re most interested in here is the &lt;code>body&lt;/code>. However, the &lt;code>body&lt;/code> is sent to us structured as json and in raw bytes. This is generally the case with an API response. &lt;code>httr2&lt;/code> has a built in function for converting the body from raw to something &lt;code>R&lt;/code> can work with &amp;ndash; &lt;code>resp_body_json()&lt;/code> &amp;ndash; and we&amp;rsquo;ll use this later, but we&amp;rsquo;ll start with the &lt;code>jsonlite&lt;/code> package to explore this process step by step.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="nf">summary&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">search_resp&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">body&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## Length Class Mode
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## 24871 raw raw
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Since we only want the &lt;code>body&lt;/code> going forward, we&amp;rsquo;ll isolate this.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">search_body&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">search_resp&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">body&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="data-wrangling">Data Wrangling
&lt;/h2>&lt;p>Our first task is to convert this raw data to character data. We can do this with &lt;code>rawToChar&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">search_body_char&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">rawToChar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">search_body&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>We&amp;rsquo;re presented with a vector of length one, which if we print out the first bit of, does not look very friendly.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="nf">summary&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">search_body_char&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## Length Class Mode
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## 1 character character
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="nf">str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">search_body_char&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## chr &amp;#34;{\&amp;#34;status\&amp;#34;:\&amp;#34;OK\&amp;#34;,\&amp;#34;data\&amp;#34;:{\&amp;#34;q\&amp;#34;:\&amp;#34;title:labour\&amp;#34;,\&amp;#34;total_count\&amp;#34;:110,\&amp;#34;start\&amp;#34;:0,\&amp;#34;spelling_alternatives\&amp;#34;:{&amp;#34;| __truncated__
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>This looks a little friendlier with &lt;code>cat()&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># not executed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">cat&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">search_body_char&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Our next task then, is to convert this JSON notation to a suitable &lt;code>R&lt;/code> data structure, in this case, a list. We&amp;rsquo;ll do this with the &lt;code>jsonlite&lt;/code> package.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">search_body_list&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">jsonlite&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="nf">fromJSON&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">search_body_char&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>If we look at how this has been converted, we can see it&amp;rsquo;s a list of two.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="nf">summary&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">search_body_list&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## Length Class Mode
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## status 1 -none- character
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## data 6 -none- list
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>The &lt;code>data&lt;/code> list is what we want. We&amp;rsquo;ll pull that out and then explore that list.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">search_data&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">search_body_list&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">summary&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">search_data&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;table class="table table-striped" style="margin-left: auto; margin-right: auto;">
&lt;thead>
&lt;tr>
&lt;th style="text-align:left;"> &lt;/th>
&lt;th style="text-align:left;"> Length &lt;/th>
&lt;th style="text-align:left;"> Class &lt;/th>
&lt;th style="text-align:left;"> Mode &lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left;"> q &lt;/td>
&lt;td style="text-align:left;"> 1 &lt;/td>
&lt;td style="text-align:left;"> -none- &lt;/td>
&lt;td style="text-align:left;"> character &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> total_count &lt;/td>
&lt;td style="text-align:left;"> 1 &lt;/td>
&lt;td style="text-align:left;"> -none- &lt;/td>
&lt;td style="text-align:left;"> numeric &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> start &lt;/td>
&lt;td style="text-align:left;"> 1 &lt;/td>
&lt;td style="text-align:left;"> -none- &lt;/td>
&lt;td style="text-align:left;"> numeric &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> spelling_alternatives &lt;/td>
&lt;td style="text-align:left;"> 0 &lt;/td>
&lt;td style="text-align:left;"> -none- &lt;/td>
&lt;td style="text-align:left;"> list &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> items &lt;/td>
&lt;td style="text-align:left;"> 27 &lt;/td>
&lt;td style="text-align:left;"> data.frame &lt;/td>
&lt;td style="text-align:left;"> list &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> count_in_response &lt;/td>
&lt;td style="text-align:left;"> 1 &lt;/td>
&lt;td style="text-align:left;"> -none- &lt;/td>
&lt;td style="text-align:left;"> numeric &lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>We&amp;rsquo;re slowly whittling this down. This now looks almost identical to what we pulled up in our browser earlier. The actual relevant content is in the &lt;code>items&lt;/code> list. But we&amp;rsquo;ll also need the &lt;code>total_count&lt;/code> for when we need to request all the data from the server in a loop. For now, let&amp;rsquo;s look at the 26 items in there.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="nf">names&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">search_data&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">items&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;name&amp;#34; &amp;#34;type&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [3] &amp;#34;url&amp;#34; &amp;#34;global_id&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [5] &amp;#34;description&amp;#34; &amp;#34;published_at&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [7] &amp;#34;publisher&amp;#34; &amp;#34;citationHtml&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [9] &amp;#34;identifier_of_dataverse&amp;#34; &amp;#34;name_of_dataverse&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [11] &amp;#34;citation&amp;#34; &amp;#34;storageIdentifier&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [13] &amp;#34;keywords&amp;#34; &amp;#34;subjects&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [15] &amp;#34;fileCount&amp;#34; &amp;#34;versionId&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [17] &amp;#34;versionState&amp;#34; &amp;#34;majorVersion&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [19] &amp;#34;minorVersion&amp;#34; &amp;#34;createdAt&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [21] &amp;#34;updatedAt&amp;#34; &amp;#34;contacts&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [23] &amp;#34;producers&amp;#34; &amp;#34;relatedMaterial&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [25] &amp;#34;geographicCoverage&amp;#34; &amp;#34;authors&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [27] &amp;#34;publications&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>We don&amp;rsquo;t need all this data. We should be able to do some evaluation with the &lt;code>name&lt;/code>, &lt;code>description&lt;/code>, &lt;code>fileCount&lt;/code>, &lt;code>producers&lt;/code>, &lt;code>published_at&lt;/code>, &lt;code>url&lt;/code>, and, for later retrieval, &lt;code>global_id&lt;/code>. Let&amp;rsquo;s look at these quickly, noting importantly, that &lt;code>producers&lt;/code> is another list, that we&amp;rsquo;ll need to wrangle some how.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">vars_of_interest&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">c&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;name&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;description&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;fileCount&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;producers&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;published_at&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;url&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;global_id&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">lapply&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">search_data&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">items[vars_of_interest]&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">class&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># show the class of each list item&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## $name
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;character&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">##
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## $description
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;character&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">##
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## $fileCount
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;integer&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">##
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## $producers
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;list&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">##
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## $published_at
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;character&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">##
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## $url
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;character&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">##
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## $global_id
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;character&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="getting-all-the-data">Getting All the Data
&lt;/h2>&lt;p>At this stage, we have what we need to pull search results from Abacus. You&amp;rsquo;ll note that the search returned a result set of 109, but only 10 items:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="n">search_body_list&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">total_count&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## [1] 110
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="nf">nrow&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">search_body_list&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">items&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## [1] 10
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Going forward, we need to paginate through the result set to retrieve all the items.&lt;/p>
&lt;p>A few things to note:&lt;/p>
&lt;ul>
&lt;li>By default, the &lt;code>search&lt;/code> API returns 10 results per request. It allows for a maximum of 1000 per request. This is handled in the &lt;code>per_page&lt;/code> parameter.&lt;/li>
&lt;li>There is a start parameter that we can feed into the request; this indicates which record to start retrieving data from. This number will need to be updated as we iterate over our requests, for example, if in the first call we pull records 1:1000, in the second call, we need to start at 1001. This is handled in the &lt;code>start&lt;/code> parameter.&lt;/li>
&lt;li>&lt;code>R&lt;/code> starts counting at 1, other languages start at 0, so the first record returned by the API is indexed at 0 on the server, not 1.&lt;/li>
&lt;li>APIs will have a limit on the number of requests you can make in any given time span. We&amp;rsquo;ll build in a simple delay using &lt;code>Sys.Sleep()&lt;/code>, but &lt;code>httr2&lt;/code> has a built in function for handling this as well.&lt;/li>
&lt;/ul>
&lt;p>Below is a function with the above steps built into it. It takes two arguments, a search string and the number of results to retrieve per request. It also prints some progress information to the console.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">search_datasets&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="kr">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">query&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">per_page&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Build the query&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">url&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">paste0&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;https://abacus.library.ubc.ca/api/search?q=&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">query&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;&amp;amp;type=dataset&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Initial call to figure out total records&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resp&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">url&lt;/span> &lt;span class="o">|&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">httr2&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="nf">request&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">|&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">httr2&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="nf">req_perform&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resp_body&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">jsonlite&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="nf">fromJSON&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">rawToChar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">resp&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">body&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">total_count&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">resp_body&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">total_count&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># Give some feedback&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">cat&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">paste0&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;There are &amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">total_count&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34; records to be fetched.\n&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;Fetching &amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">per_page&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34; records per call.\nThis will require &amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nf">ceiling&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">total_count&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">per_page&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="s">&amp;#34; calls.\n\n&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># build place holders for loop&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">vector&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">vector&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file_count&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">vector&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">producers&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">list&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pub_date&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">vector&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">global_id&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">vector&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">handle&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">vector&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># establish the starting point&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">start_point&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># create a counter for tracking calls&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">call_counter&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># run the loop&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">while&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">length&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">handle&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">total_count&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="c1"># while the number of retrieved records is &amp;lt; the total count&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">cat&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">paste0&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Call &amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">call_counter&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;\n&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="c1"># Indicate what call we&amp;#39;re on to the API&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">req&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">httr2&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="nf">request&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">paste0&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;&amp;amp;start=&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">start_point&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;&amp;amp;per_page=&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">per_page&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="c1"># create the request&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resp&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">httr2&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="nf">req_perform&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">req&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># perform the request&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resp_body&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">jsonlite&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="nf">fromJSON&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">rawToChar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">resp&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">body&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="c1"># convert the body from raw JSON to a list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resp_body_name&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">resp_body&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">items&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="c1"># get the name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resp_body_desc&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">resp_body&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">items&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">description&lt;/span> &lt;span class="c1"># get the description&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resp_body_file_count&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">resp_body&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">items&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">fileCount&lt;/span> &lt;span class="c1"># get the file count&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resp_body_producers&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">resp_body&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">items&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">producers&lt;/span> &lt;span class="c1"># get the producers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resp_body_handle&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">resp_body&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">items&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">url&lt;/span> &lt;span class="c1">#get the url&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resp_body_global_id&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">resp_body&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">items&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">global_id&lt;/span> &lt;span class="c1"># get id&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">resp_body_pubdate&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">resp_body&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">items&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">published_at&lt;/span> &lt;span class="c1"># get update date&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># update the place holders:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">name&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">c&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">resp_body_name&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">description&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">c&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">description&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">resp_body_desc&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file_count&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">c&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file_count&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">resp_body_file_count&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">producers&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">c&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">producers&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">resp_body_producers&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pub_date&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">c&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">pub_date&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">resp_body_pubdate&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">handle&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">c&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">handle&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">resp_body_handle&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">global_id&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">c&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">global_id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">resp_body_global_id&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># update counters&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">start_point&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">start_point&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">per_page&lt;/span> &lt;span class="c1"># increment the start_point&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">call_counter&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">call_counter&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="m">1&lt;/span> &lt;span class="c1"># increment the counter&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">Sys.sleep&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="m">.1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># pause before making a new call&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># When all is said and done, compile the place holders into a list and return this object&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">return&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;name&amp;#34;&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;description&amp;#34;&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">description&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;file_count&amp;#34;&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">file_count&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;producers&amp;#34;&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">producers&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;pub_date&amp;#34;&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">pub_date&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;handle&amp;#34;&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">handle&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#34;global_id&amp;#34;&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">global_id&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>We can then call that function, here adding an additional parameter indicating that we only want to search the title and that we want 50 results per query. We&amp;rsquo;re being specifically broad with our search.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">labour&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">search_datasets&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;title:labour&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">50&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## There are 110 records to be fetched.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## Fetching 50 records per call.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## This will require 3 calls.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">##
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## Call 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## Call 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## Call 3
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>We now have record data that we can explore.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="nf">summary&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">labour&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;table class="table table-striped" style="margin-left: auto; margin-right: auto;">
&lt;thead>
&lt;tr>
&lt;th style="text-align:left;"> &lt;/th>
&lt;th style="text-align:left;"> Length &lt;/th>
&lt;th style="text-align:left;"> Class &lt;/th>
&lt;th style="text-align:left;"> Mode &lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left;"> name &lt;/td>
&lt;td style="text-align:left;"> 110 &lt;/td>
&lt;td style="text-align:left;"> -none- &lt;/td>
&lt;td style="text-align:left;"> character &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> description &lt;/td>
&lt;td style="text-align:left;"> 110 &lt;/td>
&lt;td style="text-align:left;"> -none- &lt;/td>
&lt;td style="text-align:left;"> character &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> file_count &lt;/td>
&lt;td style="text-align:left;"> 110 &lt;/td>
&lt;td style="text-align:left;"> -none- &lt;/td>
&lt;td style="text-align:left;"> numeric &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> producers &lt;/td>
&lt;td style="text-align:left;"> 110 &lt;/td>
&lt;td style="text-align:left;"> -none- &lt;/td>
&lt;td style="text-align:left;"> list &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> pub_date &lt;/td>
&lt;td style="text-align:left;"> 110 &lt;/td>
&lt;td style="text-align:left;"> -none- &lt;/td>
&lt;td style="text-align:left;"> character &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> handle &lt;/td>
&lt;td style="text-align:left;"> 110 &lt;/td>
&lt;td style="text-align:left;"> -none- &lt;/td>
&lt;td style="text-align:left;"> character &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> global_id &lt;/td>
&lt;td style="text-align:left;"> 110 &lt;/td>
&lt;td style="text-align:left;"> -none- &lt;/td>
&lt;td style="text-align:left;"> character &lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>We can make this a bit easier for ourselves by converting this into a dataframe or tibble. There are several ways to approach this, considering that &lt;code>producers&lt;/code> is a list &amp;ndash; it is a list as some records have more than one producer associated them. Here, I&amp;rsquo;ll treat datasets with multiple producers as a different record authority than if one of these co-producers produced a standalone dataset. To do this, we&amp;rsquo;ll first collapse the &lt;code>producers&lt;/code> nested lists, and then flatten the result into a single list.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">labour&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">producers&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">labour&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">producers&lt;/span> &lt;span class="o">|&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">lapply&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kr">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">paste&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">collapse&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;, &amp;#34;&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="o">|&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">unlist&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">head&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">labour&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">producers&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">n&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">20&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;Statistics Canada. Labour Force Survey Division&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [2] &amp;#34;Statistics Canada. Labour Force Survey Division&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [3] &amp;#34;Statistics Canada&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [4] &amp;#34;Statistics Canada&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [5] &amp;#34;Statistics Canada&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [6] &amp;#34;Statistics Canada&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [7] &amp;#34;Statistics Canada&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [8] &amp;#34;Statistics Canada&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [9] &amp;#34;Statistics Canada&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [10] &amp;#34;Statistics Canada&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [11] &amp;#34;Statistics Canada&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [12] &amp;#34;Statistics Canada&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [13] &amp;#34;Statistics Canada&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [14] &amp;#34;Statistics Canada&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [15] &amp;#34;Statistics Canada&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [16] &amp;#34;Statistics Canada&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [17] &amp;#34;Statistics Canada&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [18] &amp;#34;Statistics Canada&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [19] &amp;#34;Statistics Canada&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [20] &amp;#34;Statistics Canada&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>We can easily convert this to a dataframe now.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">labour&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">as.data.frame&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">labour&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">head&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">labour&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;table class="table table-striped" style="margin-left: auto; margin-right: auto;">
&lt;thead>
&lt;tr>
&lt;th style="text-align:left;"> name &lt;/th>
&lt;th style="text-align:left;"> description &lt;/th>
&lt;th style="text-align:right;"> file_count &lt;/th>
&lt;th style="text-align:left;"> producers &lt;/th>
&lt;th style="text-align:left;"> pub_date &lt;/th>
&lt;th style="text-align:left;"> handle &lt;/th>
&lt;th style="text-align:left;"> global_id &lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left;"> Labour Force Survey, 2013 &lt;/td>
&lt;td style="text-align:left;"> The Labour Force Survey (LFS) is a household... &lt;/td>
&lt;td style="text-align:right;"> 14 &lt;/td>
&lt;td style="text-align:left;"> Statistics Canada. Labour Force Survey Division &lt;/td>
&lt;td style="text-align:left;"> 2013-09-10T07:00:00Z &lt;/td>
&lt;td style="text-align:left;"> https://hdl.handle.net/11272.1/AB2/HTSWUF &lt;/td>
&lt;td style="text-align:left;"> hdl:11272.1/AB2/HTSWUF &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> Labour Force Survey, 2014 &lt;/td>
&lt;td style="text-align:left;"> The Labour Force Survey (LFS) is a household... &lt;/td>
&lt;td style="text-align:right;"> 29 &lt;/td>
&lt;td style="text-align:left;"> Statistics Canada. Labour Force Survey Division &lt;/td>
&lt;td style="text-align:left;"> 2014-01-01T08:00:00Z &lt;/td>
&lt;td style="text-align:left;"> https://hdl.handle.net/11272.1/AB2/SDAVTH &lt;/td>
&lt;td style="text-align:left;"> hdl:11272.1/AB2/SDAVTH &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> Labour Force Survey, 2023 &lt;/td>
&lt;td style="text-align:left;"> LFS data are used to produce the well-known ... &lt;/td>
&lt;td style="text-align:right;"> 31 &lt;/td>
&lt;td style="text-align:left;"> Statistics Canada &lt;/td>
&lt;td style="text-align:left;"> 2024-01-05T17:38:25Z &lt;/td>
&lt;td style="text-align:left;"> https://hdl.handle.net/11272.1/AB2/IJU1QK &lt;/td>
&lt;td style="text-align:left;"> hdl:11272.1/AB2/IJU1QK &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> Labour Force Survey, 2006 &lt;/td>
&lt;td style="text-align:left;"> The Labour Force Survey provides estimates o... &lt;/td>
&lt;td style="text-align:right;"> 26 &lt;/td>
&lt;td style="text-align:left;"> Statistics Canada &lt;/td>
&lt;td style="text-align:left;"> 2023-03-16T21:47:04Z &lt;/td>
&lt;td style="text-align:left;"> https://hdl.handle.net/11272.1/AB2/0B5LPL &lt;/td>
&lt;td style="text-align:left;"> hdl:11272.1/AB2/0B5LPL &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> Labour Force Survey, 2008 &lt;/td>
&lt;td style="text-align:left;"> The Labour Force Survey provides estimates o... &lt;/td>
&lt;td style="text-align:right;"> 26 &lt;/td>
&lt;td style="text-align:left;"> Statistics Canada &lt;/td>
&lt;td style="text-align:left;"> 2023-03-16T21:47:20Z &lt;/td>
&lt;td style="text-align:left;"> https://hdl.handle.net/11272.1/AB2/LA3WXI &lt;/td>
&lt;td style="text-align:left;"> hdl:11272.1/AB2/LA3WXI &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> Labour Force Survey, 2007 &lt;/td>
&lt;td style="text-align:left;"> The Labour Force Survey provides estimates o... &lt;/td>
&lt;td style="text-align:right;"> 26 &lt;/td>
&lt;td style="text-align:left;"> Statistics Canada &lt;/td>
&lt;td style="text-align:left;"> 2023-03-16T21:29:41Z &lt;/td>
&lt;td style="text-align:left;"> https://hdl.handle.net/11272.1/AB2/NANO81 &lt;/td>
&lt;td style="text-align:left;"> hdl:11272.1/AB2/NANO81 &lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="explore">Explore
&lt;/h2>&lt;p>We have several datasets with labour in the title. One way of handling exploring this is to strip the dates so that we can look for unique values. First we extract the date:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">labour&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">year&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">gsub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;.*?([0-9]+).*$&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;\\1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">labour&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># regex to find ending numbers and storing in a new var&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">head&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">labour&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">year&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;2013&amp;#34; &amp;#34;2014&amp;#34; &amp;#34;2023&amp;#34; &amp;#34;2006&amp;#34; &amp;#34;2008&amp;#34; &amp;#34;2007&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Then we strip the name:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">labour&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">name_no_year&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">trimws&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">gsub&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;[[:punct:]]|[[:digit:]]&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">labour&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">name&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="c1"># regex to remove punctuation and remaing numbers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">head&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">labour&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">name_no_year&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;Labour Force Survey&amp;#34; &amp;#34;Labour Force Survey&amp;#34; &amp;#34;Labour Force Survey&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [4] &amp;#34;Labour Force Survey&amp;#34; &amp;#34;Labour Force Survey&amp;#34; &amp;#34;Labour Force Survey&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>And then look at the unique values:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="nf">unique&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">labour&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">name_no_year&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;Labour Force Survey&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [2] &amp;#34;Survey of Labour and Income Dynamics&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [3] &amp;#34;Cultural Labour Force Survey&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [4] &amp;#34;Survey of Persons Not in the Labour Force&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [5] &amp;#34;Labour Force Income Profiles&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [6] &amp;#34;Labour Force Survey Rebased Revised&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [7] &amp;#34;Survey of Labour and Income Dynamics Reweighted&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [8] &amp;#34;Labour Force Survey revision&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [9] &amp;#34;Labour Income Profile for selected BC communities&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [10] &amp;#34;Labour Market Activity Survey&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [11] &amp;#34;Labour force historical review&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [12] &amp;#34;Small Area Business and Labour Database&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [13] &amp;#34;Labour Force Historical Review&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [14] &amp;#34;Interwar Labour Database&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [15] &amp;#34;Experienced Labour Force Population by Occupation custom tabulation&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [16] &amp;#34;Labour Market Activity Survey Crosssectional Files&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [17] &amp;#34;Experienced Labour Force Population by Industry and Occupation custom tabulation&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [18] &amp;#34;Labour Market Activity Survey Longitudinal Files&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [19] &amp;#34;New Survey of London Life and Labour&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>We only need the Labour Force Surveys themselves. These are occasionally revised, &lt;a class="link" href="https://www150.statcan.gc.ca/n1/pub/71f0031x/71f0031x2023001-eng.htm" target="_blank" rel="noopener"
>documentation on these revisions here&lt;/a>, hence multiple records with slightly modified names (Labour Force Survey, Labour Force Survey (Rebased, Revised), etc)&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">lfs&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">labour&lt;/span>&lt;span class="nf">[grepl&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;^Labour Force Survey&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">labour&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">name_no_year&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="n">]&lt;/span> &lt;span class="c1"># regex to find names starting with LFS&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">head&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">lfs&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;table class="table table-striped" style="margin-left: auto; margin-right: auto;">
&lt;thead>
&lt;tr>
&lt;th style="text-align:left;"> name &lt;/th>
&lt;th style="text-align:left;"> description &lt;/th>
&lt;th style="text-align:right;"> file_count &lt;/th>
&lt;th style="text-align:left;"> producers &lt;/th>
&lt;th style="text-align:left;"> pub_date &lt;/th>
&lt;th style="text-align:left;"> handle &lt;/th>
&lt;th style="text-align:left;"> global_id &lt;/th>
&lt;th style="text-align:left;"> year &lt;/th>
&lt;th style="text-align:left;"> name_no_year &lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left;"> Labour Force Survey, 2013 &lt;/td>
&lt;td style="text-align:left;"> The Labour Force Survey (LFS) is a household... &lt;/td>
&lt;td style="text-align:right;"> 14 &lt;/td>
&lt;td style="text-align:left;"> Statistics Canada. Labour Force Survey Division &lt;/td>
&lt;td style="text-align:left;"> 2013-09-10T07:00:00Z &lt;/td>
&lt;td style="text-align:left;"> https://hdl.handle.net/11272.1/AB2/HTSWUF &lt;/td>
&lt;td style="text-align:left;"> hdl:11272.1/AB2/HTSWUF &lt;/td>
&lt;td style="text-align:left;"> 2013 &lt;/td>
&lt;td style="text-align:left;"> Labour Force Survey &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> Labour Force Survey, 2014 &lt;/td>
&lt;td style="text-align:left;"> The Labour Force Survey (LFS) is a household... &lt;/td>
&lt;td style="text-align:right;"> 29 &lt;/td>
&lt;td style="text-align:left;"> Statistics Canada. Labour Force Survey Division &lt;/td>
&lt;td style="text-align:left;"> 2014-01-01T08:00:00Z &lt;/td>
&lt;td style="text-align:left;"> https://hdl.handle.net/11272.1/AB2/SDAVTH &lt;/td>
&lt;td style="text-align:left;"> hdl:11272.1/AB2/SDAVTH &lt;/td>
&lt;td style="text-align:left;"> 2014 &lt;/td>
&lt;td style="text-align:left;"> Labour Force Survey &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> Labour Force Survey, 2023 &lt;/td>
&lt;td style="text-align:left;"> LFS data are used to produce the well-known ... &lt;/td>
&lt;td style="text-align:right;"> 31 &lt;/td>
&lt;td style="text-align:left;"> Statistics Canada &lt;/td>
&lt;td style="text-align:left;"> 2024-01-05T17:38:25Z &lt;/td>
&lt;td style="text-align:left;"> https://hdl.handle.net/11272.1/AB2/IJU1QK &lt;/td>
&lt;td style="text-align:left;"> hdl:11272.1/AB2/IJU1QK &lt;/td>
&lt;td style="text-align:left;"> 2023 &lt;/td>
&lt;td style="text-align:left;"> Labour Force Survey &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> Labour Force Survey, 2006 &lt;/td>
&lt;td style="text-align:left;"> The Labour Force Survey provides estimates o... &lt;/td>
&lt;td style="text-align:right;"> 26 &lt;/td>
&lt;td style="text-align:left;"> Statistics Canada &lt;/td>
&lt;td style="text-align:left;"> 2023-03-16T21:47:04Z &lt;/td>
&lt;td style="text-align:left;"> https://hdl.handle.net/11272.1/AB2/0B5LPL &lt;/td>
&lt;td style="text-align:left;"> hdl:11272.1/AB2/0B5LPL &lt;/td>
&lt;td style="text-align:left;"> 2006 &lt;/td>
&lt;td style="text-align:left;"> Labour Force Survey &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> Labour Force Survey, 2008 &lt;/td>
&lt;td style="text-align:left;"> The Labour Force Survey provides estimates o... &lt;/td>
&lt;td style="text-align:right;"> 26 &lt;/td>
&lt;td style="text-align:left;"> Statistics Canada &lt;/td>
&lt;td style="text-align:left;"> 2023-03-16T21:47:20Z &lt;/td>
&lt;td style="text-align:left;"> https://hdl.handle.net/11272.1/AB2/LA3WXI &lt;/td>
&lt;td style="text-align:left;"> hdl:11272.1/AB2/LA3WXI &lt;/td>
&lt;td style="text-align:left;"> 2008 &lt;/td>
&lt;td style="text-align:left;"> Labour Force Survey &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> Labour Force Survey, 2007 &lt;/td>
&lt;td style="text-align:left;"> The Labour Force Survey provides estimates o... &lt;/td>
&lt;td style="text-align:right;"> 26 &lt;/td>
&lt;td style="text-align:left;"> Statistics Canada &lt;/td>
&lt;td style="text-align:left;"> 2023-03-16T21:29:41Z &lt;/td>
&lt;td style="text-align:left;"> https://hdl.handle.net/11272.1/AB2/NANO81 &lt;/td>
&lt;td style="text-align:left;"> hdl:11272.1/AB2/NANO81 &lt;/td>
&lt;td style="text-align:left;"> 2007 &lt;/td>
&lt;td style="text-align:left;"> Labour Force Survey &lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="looking-at-files">Looking at Files
&lt;/h2>&lt;p>We now know the data sets we&amp;rsquo;re interested in. A dataset is made up of multiple files, however, and we likely don&amp;rsquo;t want all the files for every dataset. We&amp;rsquo;ll start by getting the file list for one of our datasets. Once we can do this for one dataset, we can iterate over all the datasets, although we won&amp;rsquo;t implement that in this workshop.&lt;/p>
&lt;p>Up until now, we&amp;rsquo;ve been using the &lt;code>search&lt;/code> api. We&amp;rsquo;ll now use the &lt;code>datasets&lt;/code> api.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">datasets_api&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="s">&amp;#34;datasets/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Like before, we&amp;rsquo;ll build our query. We&amp;rsquo;ll start with the 2011 LFS dataset. This is a multi-step process, as the first thing we need to do is get the &lt;code>id&lt;/code> for the dataset, which is different from the &lt;code>global_id&lt;/code> we retrieved from the &lt;code>search&lt;/code> api, but we need the &lt;code>global_id&lt;/code>, piped into the &lt;code>datasets&lt;/code> api, to get the &lt;code>id&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">id&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">lfs[lfs&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#34;Labour Force Survey, 2011&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;global_id&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">drop&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">TRUE&lt;/span>&lt;span class="n">]&lt;/span> &lt;span class="c1"># we want a simple vector returned&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">query&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">paste0&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;:persistentId/?persistentId=&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">id&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># limit to the id of interest, see dataverse API documentation&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">(&lt;/span>&lt;span class="n">dataset_api_call&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">paste0&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">base_url&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">datasets_api&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">query&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="c1"># build the call&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;https://abacus.library.ubc.ca/api/datasets/:persistentId/?persistentId=hdl:11272.1/AB2/GK3SFF&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Now we make the call and process the &lt;code>body&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">dataset_id_resp&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">dataset_api_call&lt;/span> &lt;span class="o">|&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">httr2&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="nf">request&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">|&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">httr2&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="nf">req_perform&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">dataset_id_body&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">jsonlite&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="nf">fromJSON&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">rawToChar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dataset_id_resp&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">body&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>We need the &lt;code>id&lt;/code> and the &lt;code>versionNumber&lt;/code> to access a file list.&lt;/p>
&lt;p>Building the call:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">dataset_id&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">dataset_id_body&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">id&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">dataset_ver&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">dataset_id_body&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">latestVersion&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="nf">versionNumber
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file_list_query&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">paste0&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">base_url&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">datasets_api&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dataset_id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;/versions/&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dataset_ver&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;/files/&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;https://abacus.library.ubc.ca/api/datasets/45508/versions/2/files/&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Then execute, this time using the &lt;code>httr2&lt;/code> option, &lt;code>resp_body_json()&lt;/code> to convert the body to an &lt;code>R&lt;/code> object, as it&amp;rsquo;s a bit more streamlined.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">dataset_file_resp&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">file_list_query&lt;/span> &lt;span class="o">|&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">httr2&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="nf">request&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">|&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">httr2&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="nf">req_perform&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">|&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">httr2&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="nf">resp_body_json&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Files are generally indicated as being either data, documentation, or command files. We&amp;rsquo;ll isolate just the data files in the list. All relevant data files have a &lt;code>directoryLabel&lt;/code> equal to &lt;code>Data&lt;/code>. We can use this to access only the data files.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">data_files&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">Filter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kr">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">directoryLabel&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#34;Data&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dataset_file_resp&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># filter by directoryLabel&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>We&amp;rsquo;ll list out the files&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">for&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="kr">in&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="nf">length&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data_files&lt;/span>&lt;span class="p">)){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data_files[[i]]&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">label&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;LFS_April_2011.tab&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;LFS_August_2011.tab&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;LFS_December_2011.tab&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;LFS_February_2011.tab&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;LFS_January_2011.tab&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;LFS_July_2011.tab&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;LFS_June_2011.tab&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;LFS_March_2011.tab&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;LFS_May_2011.tab&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;LFS_November_2011.tab&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;LFS_October_2011.tab&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;LFS_September_2011.tab&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;pub0111.prn&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;pub0211.prn&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;pub0311.prn&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;pub0411.prn&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;pub0511.prn&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;pub0611.prn&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;pub0711.prn&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;pub0811.prn&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;pub0911.prn&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;pub1011.prn&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;pub1111.prn&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## [1] &amp;#34;pub1211.prn&amp;#34;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>From which we&amp;rsquo;ll see that there are two different formats available to us. Let&amp;rsquo;s grab just the &lt;code>.tab&lt;/code> files.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">relevant_data_files&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">Filter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kr">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">grepl&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;tab$&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">label&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">data_files&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># filter to files ending in tab&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>And then download them.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="nf">dir.create&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;LFS_2011&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># create a directory&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">dest_dir&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="s">&amp;#34;LFS_2011/&amp;#34;&lt;/span> &lt;span class="c1"># store it in a variable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># loop through the files and download them&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">for&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">i&lt;/span> &lt;span class="kr">in&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="nf">length&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">relevant_data_files&lt;/span>&lt;span class="p">)){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file_name&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">relevant_data_files[[i]]&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">label&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file_id&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">relevant_data_files[[i]]&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">dataFile&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">id&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">url_root&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="s">&amp;#34;https://abacus.library.ubc.ca/api/access/datafile/&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">download.file&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">url&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">paste0&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">url_root&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">file_id&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">destfile&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">paste0&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dest_dir&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">file_name&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>And build an annual set&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">lfs_2011_list&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">lapply&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">list.files&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dest_dir&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="kr">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">read.delim&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">paste0&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dest_dir&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="p">)))&lt;/span> &lt;span class="c1"># read in each tab file into a list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">lfs_2011_df&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">do.call&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">rbind&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lfs_2011_list&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># bind the list items into a df&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">summary&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">lfs_2011_df[&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nf">c&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="m">11&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="n">]&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">|&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">kbl&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">|&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">kable_styling&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">bootstrap_options&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#34;striped&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;table class="table table-striped" style="margin-left: auto; margin-right: auto;">
&lt;thead>
&lt;tr>
&lt;th style="text-align:left;"> &lt;/th>
&lt;th style="text-align:left;"> REC_NUM &lt;/th>
&lt;th style="text-align:left;"> SURVYEAR &lt;/th>
&lt;th style="text-align:left;"> SURVMNTH &lt;/th>
&lt;th style="text-align:left;"> LFSSTAT &lt;/th>
&lt;th style="text-align:left;"> PROV &lt;/th>
&lt;th style="text-align:left;"> CMA &lt;/th>
&lt;th style="text-align:left;"> AGE_12 &lt;/th>
&lt;th style="text-align:left;"> AGE_6 &lt;/th>
&lt;th style="text-align:left;"> SEX &lt;/th>
&lt;th style="text-align:left;"> MARSTAT &lt;/th>
&lt;th style="text-align:left;"> EDUC &lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left;"> &lt;/td>
&lt;td style="text-align:left;"> Min. : 1 &lt;/td>
&lt;td style="text-align:left;"> Min. :2011 &lt;/td>
&lt;td style="text-align:left;"> Min. : 1.000 &lt;/td>
&lt;td style="text-align:left;"> Min. :1.00 &lt;/td>
&lt;td style="text-align:left;"> Min. :10.0 &lt;/td>
&lt;td style="text-align:left;"> Min. :0.000 &lt;/td>
&lt;td style="text-align:left;"> Min. : 1.000 &lt;/td>
&lt;td style="text-align:left;"> Min. :1.0 &lt;/td>
&lt;td style="text-align:left;"> Min. :1.000 &lt;/td>
&lt;td style="text-align:left;"> Min. :1.000 &lt;/td>
&lt;td style="text-align:left;"> Min. :0.000 &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> &lt;/td>
&lt;td style="text-align:left;"> 1st Qu.: 26294 &lt;/td>
&lt;td style="text-align:left;"> 1st Qu.:2011 &lt;/td>
&lt;td style="text-align:left;"> 1st Qu.: 4.000 &lt;/td>
&lt;td style="text-align:left;"> 1st Qu.:1.00 &lt;/td>
&lt;td style="text-align:left;"> 1st Qu.:24.0 &lt;/td>
&lt;td style="text-align:left;"> 1st Qu.:0.000 &lt;/td>
&lt;td style="text-align:left;"> 1st Qu.: 4.000 &lt;/td>
&lt;td style="text-align:left;"> 1st Qu.:2.0 &lt;/td>
&lt;td style="text-align:left;"> 1st Qu.:1.000 &lt;/td>
&lt;td style="text-align:left;"> 1st Qu.:1.000 &lt;/td>
&lt;td style="text-align:left;"> 1st Qu.:2.000 &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> &lt;/td>
&lt;td style="text-align:left;"> Median : 52587 &lt;/td>
&lt;td style="text-align:left;"> Median :2011 &lt;/td>
&lt;td style="text-align:left;"> Median : 7.000 &lt;/td>
&lt;td style="text-align:left;"> Median :1.00 &lt;/td>
&lt;td style="text-align:left;"> Median :35.0 &lt;/td>
&lt;td style="text-align:left;"> Median :0.000 &lt;/td>
&lt;td style="text-align:left;"> Median : 7.000 &lt;/td>
&lt;td style="text-align:left;"> Median :4.0 &lt;/td>
&lt;td style="text-align:left;"> Median :2.000 &lt;/td>
&lt;td style="text-align:left;"> Median :2.000 &lt;/td>
&lt;td style="text-align:left;"> Median :3.000 &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> &lt;/td>
&lt;td style="text-align:left;"> Mean : 52589 &lt;/td>
&lt;td style="text-align:left;"> Mean :2011 &lt;/td>
&lt;td style="text-align:left;"> Mean : 6.509 &lt;/td>
&lt;td style="text-align:left;"> Mean :2.19 &lt;/td>
&lt;td style="text-align:left;"> Mean :35.1 &lt;/td>
&lt;td style="text-align:left;"> Mean :1.473 &lt;/td>
&lt;td style="text-align:left;"> Mean : 6.765 &lt;/td>
&lt;td style="text-align:left;"> Mean :3.5 &lt;/td>
&lt;td style="text-align:left;"> Mean :1.516 &lt;/td>
&lt;td style="text-align:left;"> Mean :2.834 &lt;/td>
&lt;td style="text-align:left;"> Mean :3.008 &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> &lt;/td>
&lt;td style="text-align:left;"> 3rd Qu.: 78880 &lt;/td>
&lt;td style="text-align:left;"> 3rd Qu.:2011 &lt;/td>
&lt;td style="text-align:left;"> 3rd Qu.: 9.000 &lt;/td>
&lt;td style="text-align:left;"> 3rd Qu.:4.00 &lt;/td>
&lt;td style="text-align:left;"> 3rd Qu.:47.0 &lt;/td>
&lt;td style="text-align:left;"> 3rd Qu.:2.000 &lt;/td>
&lt;td style="text-align:left;"> 3rd Qu.:10.000 &lt;/td>
&lt;td style="text-align:left;"> 3rd Qu.:5.0 &lt;/td>
&lt;td style="text-align:left;"> 3rd Qu.:2.000 &lt;/td>
&lt;td style="text-align:left;"> 3rd Qu.:6.000 &lt;/td>
&lt;td style="text-align:left;"> 3rd Qu.:4.000 &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> &lt;/td>
&lt;td style="text-align:left;"> Max. :106352 &lt;/td>
&lt;td style="text-align:left;"> Max. :2011 &lt;/td>
&lt;td style="text-align:left;"> Max. :12.000 &lt;/td>
&lt;td style="text-align:left;"> Max. :4.00 &lt;/td>
&lt;td style="text-align:left;"> Max. :59.0 &lt;/td>
&lt;td style="text-align:left;"> Max. :9.000 &lt;/td>
&lt;td style="text-align:left;"> Max. :12.000 &lt;/td>
&lt;td style="text-align:left;"> Max. :6.0 &lt;/td>
&lt;td style="text-align:left;"> Max. :2.000 &lt;/td>
&lt;td style="text-align:left;"> Max. :6.000 &lt;/td>
&lt;td style="text-align:left;"> Max. :6.000 &lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left;"> &lt;/td>
&lt;td style="text-align:left;"> NA &lt;/td>
&lt;td style="text-align:left;"> NA &lt;/td>
&lt;td style="text-align:left;"> NA &lt;/td>
&lt;td style="text-align:left;"> NA &lt;/td>
&lt;td style="text-align:left;"> NA &lt;/td>
&lt;td style="text-align:left;"> NA &lt;/td>
&lt;td style="text-align:left;"> NA &lt;/td>
&lt;td style="text-align:left;"> NA's :975211 &lt;/td>
&lt;td style="text-align:left;"> NA &lt;/td>
&lt;td style="text-align:left;"> NA &lt;/td>
&lt;td style="text-align:left;"> NA &lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table></description></item><item><title>Transforming data</title><link>https://csc-ubc-okanagan.github.io/csc-data-blog/p/transforming-data/</link><pubDate>Mon, 07 Oct 2024 14:00:00 -0800</pubDate><guid>https://csc-ubc-okanagan.github.io/csc-data-blog/p/transforming-data/</guid><description>&lt;!-- This blog covers data transformations in `R`. If you use `Python`, see [this post](needs-a-url). -->
&lt;h2 id="transforming-response-variables">Transforming response variables
&lt;/h2>&lt;p>Data transformations are often taught in introductory quantitative and statistics courses as methods for dealing with non-Gaussian (i.e., not normal) data, whether it be bounded (e.g, strictly positive) or skewed (&lt;a class="link" href="https://ubco-biology.github.io/BIOL202/transform.html" target="_blank" rel="noopener"
>https://ubco-biology.github.io/BIOL202/transform.html&lt;/a>; &lt;a class="link" href="https://ubco-biology.github.io/BIOL202/LSR.html#transform-the-data" target="_blank" rel="noopener"
>https://ubco-biology.github.io/BIOL202/LSR.html#transform-the-data&lt;/a>; Section 13.3 in Whitlock &amp;amp; Schluter 2020). In this post, I use simulated data to demonstrate issues that might arise with transforming data. I use a simulated dataset rather than an empirical one so we can compare the model results to the truth.&lt;/p>
&lt;p>Imagine that a dangerous intersection has been causing frequent accidents between motored vehicles. A local group of concerned citizens decides to count the number of monthly accidents and report it to City Council. City Council decides to intervene by placing better street signs and lighting. The group of citizens then decided to count the number of accidents again to test whether or not there was an improvement in the number of accidents.&lt;/p>
&lt;p>For the sake of this post, let&amp;rsquo;s assume that the mean number of accidents in the 12 months before the intervention was &lt;code>\(\lambda_0=2\)&lt;/code> per month. In the 12 months after the intervention, the mean number of monthly accidents decreases to &lt;code>\(\lambda_1 = 0.4\)&lt;/code>. We can then simulate data for before and after the intervention as follows:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="nf">library&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#39;dplyr&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># for data wrangling&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">library&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#39;tidyr&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># for data wrangling&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">library&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#39;mgcv&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># for modeling&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">library&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#39;ggplot2&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># for fancy plots&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">library&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#39;gratia&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># for diagnostic plots in ggplot&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># change default ggplot theme&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">theme_set&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">theme_bw&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">theme&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">panel.grid&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">element_blank&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">legend.position&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;top&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">text&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">element_text&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">face&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;bold&amp;#39;&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">set.seed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="m">2024+10+7&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1"># for reproducible results&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">d&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">expand_grid&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">month&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="m">12&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">period&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">factor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">c&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#39;before&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#39;after&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">levels&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">c&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#39;before&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#39;after&amp;#39;&lt;/span>&lt;span class="p">)))&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">mutate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">lambda&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">if_else&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">period&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#39;before&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">true&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">false&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">0.4&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">accidents&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">rpois&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">n&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">lambda&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">lambda&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">ggplot&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">facet_wrap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">~&lt;/span> &lt;span class="n">period&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">ncol&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">geom_histogram&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">aes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">accidents&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">binwidth&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">fill&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;grey&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">color&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;black&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">geom_vline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">aes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">xintercept&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">lambda&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">color&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;darkorange&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lwd&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">labs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;Accidents per month&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;Count&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;img src="https://csc-ubc-okanagan.github.io/csc-data-blog/p/transforming-data/index.en_files/figure-html/unnamed-chunk-1-1.png" width="\linewidth" />
&lt;p>The distribution of the number of monthly accidents is clearly non-Gaussian both before and after the intervention. (&lt;em>Also note that the number of accidents cannot be negative.&lt;/em>) Still, let&amp;rsquo;s fit a linear model to estimate the mean number of accidents in each period. In this post I use the &lt;code>mgcv::gam()&lt;/code> function to fit all models for consistency and convenience, but note that you could also use the &lt;code>stats::lm()&lt;/code> and &lt;code>stats::glm()&lt;/code> functions, too. After fitting the model, we can look at the estimated change in mean accidents and appraise the model using diagnostic plots.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">m_1&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">gam&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">accidents&lt;/span> &lt;span class="o">~&lt;/span> &lt;span class="n">period&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">coef&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m_1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## (Intercept) periodafter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## 1.666667 -1.250000
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>From the output of the &lt;code>coef()&lt;/code> function, we can see that the estimated model is &lt;code>$$Y = 1.67 - 1.25\,x_1,$$&lt;/code> where &lt;code>\(x_1\)&lt;/code> is 0 for before the intervention and 1 for after. The &lt;code>periodafter&lt;/code> coefficient indicates that there were -1.25 less accidents per month after the intervention. While this does not match the true effect of &lt;code>\(2 - 0.4 = 1.6\)&lt;/code>, we should expect some random variation, and the estimate is still reasonable. Longer observational periods would give us more accurate estimates.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="nf">appraise&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m_1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">point_alpha&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">0.3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;img src="https://csc-ubc-okanagan.github.io/csc-data-blog/p/transforming-data/index.en_files/figure-html/unnamed-chunk-3-1.png" width="\linewidth" />
&lt;p>Those who are used to looking at these plots may recognize two issues: (1) the residuals are not Gaussian (see the q-q plot and the histogram, in the left column), and (2) the variance in the observed values is lower when the predicted mean (linear predictor and fitted values) is lower. One may then decide to log-transform the number of accidents, after adding a small value to avoid taking the log of zero (since &lt;code>\(\log(0) = - \infty\)&lt;/code>).&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># find proportion of months with no accidents&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">d&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">group_by&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">period&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">summarize&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">prop_zero&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">mean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">accidents&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## # A tibble: 2  2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## period prop_zero
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## &amp;lt;fct&amp;gt; &amp;lt;dbl&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## 1 before 0.167
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## 2 after 0.667
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># add a variable of log(accidents + 1)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">d&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">log1p_accidents&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">log1p&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">accidents&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">m_2&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">gam&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">log1p_accidents&lt;/span> &lt;span class="o">~&lt;/span> &lt;span class="n">period&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">coef&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m_2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## (Intercept) periodafter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## 0.8620910 -0.5972532
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="nf">appraise&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m_2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">point_alpha&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">0.3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;img src="https://csc-ubc-okanagan.github.io/csc-data-blog/p/transforming-data/index.en_files/figure-html/unnamed-chunk-4-1.png" width="\linewidth" />
&lt;p>The &lt;code>log1p&lt;/code> transformation resulted in a somewhat more symmetrical distribution of residuals, and the mode of the distribution is closer to zero, and improved the issue of non-constant variance (heteroskedasticity). The coefficients are also harder to interpret because they are on the &lt;code>log1p&lt;/code> scale, since the model is &lt;code>$$\log(Y+1)=0.86 - 0.60 \,x_1.$$&lt;/code>&lt;/p>
&lt;p>Rather than forcing our response variable to be Gaussian when it isn&amp;rsquo;t (see &lt;a class="link" href="https://events.ok.ubc.ca/event/fitting-models-to-data-not-data-to-models-eight-workshop-series/" target="_blank" rel="noopener"
>this modeling workshop&lt;/a> I created with the CSC), we can fit a model that fits our data well: a Generalized Linear Model (GLM). GLMs allow one to recognize the structure of the response variable (e.g., any bounds and the mean-variance relationship) by specifying an appropriate statistical distribution (e.g., Gaussian, binomial, etc.).&lt;/p>
&lt;p>The Poisson distribution is a good option because it represents the number of events that occur within a given period of time and location. We can fit a Poisson GLM by specifying the family in the &lt;code>gam()&lt;/code> function:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">m_3&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">gam&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">accidents&lt;/span> &lt;span class="o">~&lt;/span> &lt;span class="n">period&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">family&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">poisson&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">link&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;log&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">coef&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m_3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## (Intercept) periodafter
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## 0.5108256 -1.3862944
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="nf">appraise&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m_3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">point_alpha&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">0.3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;img src="https://csc-ubc-okanagan.github.io/csc-data-blog/p/transforming-data/index.en_files/figure-html/unnamed-chunk-5-1.png" width="\linewidth" />
&lt;p>The output from &lt;code>coef()&lt;/code> tells us that the GLM is &lt;code>$$\lambda = e{0.51-1.39\,x_1}.$$&lt;/code> This means that after the intervention, the number of accidents decreased to &lt;code>\(e^-1.39 * 100%= 0.25%\)&lt;/code> what they were in the 12 months before.&lt;/p>
&lt;p>With the GLM, we can see a improvement in both the q-q plot and histogram of residuals, and while the variance still increases with the mean number of accidents, the model now expects that to be the case. This is because the variance of a Poisson distributions is equal to its mean, both of which are usually indicated as &lt;code>\(\lambda\)&lt;/code> rather than &lt;code>\(\lambda\)&lt;/code>.&lt;/p>
&lt;p>The &lt;code>\(\log\)&lt;/code> link function (&lt;code>link = 'log'&lt;/code>) allows us to create a model that will only give us non-negative numbers of accidents by having the form &lt;code>$$\log(\lambda) = 0.51-1.39 \, x_1,$$&lt;/code> which we can re-write as &lt;code>$$\lambda = e^{ 0.51-1.39 \, x_1}.$$&lt;/code> Notice that while this model may look similar to the &lt;code>log1p&lt;/code> model, the &lt;code>\(\log\)&lt;/code> function is applied to &lt;code>\(\lambda\)&lt;/code>, the mean of &lt;code>\(Y\)&lt;/code>, rather than to &lt;code>\(Y\)&lt;/code> directly. This is important because it removes the systematic bias that results from applying non-linear transformations such as &lt;code>\(\log(Y)\)&lt;/code>, &lt;code>\(\sqrt{Y}\)&lt;/code>, and &lt;code>\(\arcsin\left(\sqrt{Y}\right)\)&lt;/code> to a random variable. Now that we have three models, let&amp;rsquo;s compare between the predictions that the tree give us:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># predictions&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">pred&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="kr">function&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">model&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">model_type&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">p&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">predict&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">model&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">newdata&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">newdata&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">se.fit&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">TRUE&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">as.data.frame&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">p&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="n">p&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">transmute&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">model&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">model_type&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1"># get predictions and approximate 95% Bayesian Credible Intervals&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">est&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">case_when&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">model&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#39;LM&amp;#39;&lt;/span> &lt;span class="o">~&lt;/span> &lt;span class="n">fit&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">grepl&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#39;log1p&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">model&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">~&lt;/span> &lt;span class="nf">exp&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fit&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">model&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#39;Poisson GLM&amp;#39;&lt;/span> &lt;span class="o">~&lt;/span> &lt;span class="nf">exp&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fit&lt;/span>&lt;span class="p">)),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lwr_95&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">case_when&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">model&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#39;LM&amp;#39;&lt;/span> &lt;span class="o">~&lt;/span> &lt;span class="n">fit&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="m">1.96&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">se.fit&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">grepl&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#39;log1p&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">model&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">~&lt;/span> &lt;span class="nf">exp&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fit&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="m">1.96&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">se.fit&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">model&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#39;Poisson GLM&amp;#39;&lt;/span> &lt;span class="o">~&lt;/span> &lt;span class="nf">exp&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fit&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="m">1.96&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">se.fit&lt;/span>&lt;span class="p">)),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">upr_95&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">case_when&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">model&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#39;LM&amp;#39;&lt;/span> &lt;span class="o">~&lt;/span> &lt;span class="n">fit&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="m">1.96&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">se.fit&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">grepl&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#39;log1p&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">model&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">~&lt;/span> &lt;span class="nf">exp&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fit&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="m">1.96&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">se.fit&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">-&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">model&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#39;Poisson GLM&amp;#39;&lt;/span> &lt;span class="o">~&lt;/span> &lt;span class="nf">exp&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fit&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="m">1.96&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">se.fit&lt;/span>&lt;span class="p">)))&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">bind_cols&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">newdata&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">.)&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">mutate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">paste&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">period&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">model&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">p&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">newdata&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">tibble&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">period&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">unique&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="o">$&lt;/span>&lt;span class="n">period&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">preds&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">bind_rows&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">pred&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">model&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">m_1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">model_type&lt;/span>&lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;LM&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">pred&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">model&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">m_2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">model_type&lt;/span>&lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;LM of log1p&amp;#39;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">pred&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">model&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">m_3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">model_type&lt;/span>&lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;Poisson GLM&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">ggplot&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">facet_wrap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">~&lt;/span> &lt;span class="n">period&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">nrow&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">geom_hline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">yintercept&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">color&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;grey&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">geom_hline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">aes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">yintercept&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">lambda&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">color&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;black&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lty&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;dashed&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">geom_jitter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">aes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#39;LM of log1p&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">accidents&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">alpha&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">0.3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">height&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">geom_errorbar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">aes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">model&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">ymin&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">lwr_95&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">ymax&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">upr_95&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">color&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">model&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">preds&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">alpha&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">0.3&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">width&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">geom_point&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">aes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">model&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">est&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">color&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">model&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">preds&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">labs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">NULL&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;Number of accidents&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">khroma&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="nf">scale_color_highcontrast&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;Model&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;img src="https://csc-ubc-okanagan.github.io/csc-data-blog/p/transforming-data/index.en_files/figure-html/unnamed-chunk-6-1.png" width="\linewidth" />
&lt;p>From the plot above, we can see that the LM and GLM have fairly similar coefficient estimates and that the &lt;code>log1p&lt;/code> LM resulted in lower estimates for both. This is due to a systematic bias that occurs when one applies a nonlinear transformation to a random variable, like &lt;code>\(\log(Y)\)&lt;/code>. I explain why in the sections below. Additionally, while the LM&amp;rsquo;s coefficients are reasonable, the 95% &lt;a class="link" href="https://en.wikipedia.org/wiki/Credible_interval" target="_blank" rel="noopener"
>Bayesian Credible Intervals&lt;/a> (BCIs) for the post-intervention estimate are not appropriate because they include negative values. In contrast, the GLM&amp;rsquo;s BCIs are asymmetric: they are shorter below the mean and longer above the mean. This is recognizes that a multiplicative change for large values is larger than one for small values: a 50% decrease will take 2 to 1 and take 4 to 2. Consequently, asymmetric BCIs provide a better representation of the model&amp;rsquo;s uncertainty.&lt;/p>
&lt;h2 id="linear-and-nonlinear-transformations">Linear and nonlinear transformations
&lt;/h2>&lt;p>I want to end this section by explaining the difference between linear and nonlinear transformations and how the two impact modeling. Linear transformations include all transformations that can be written as a series of additions, subtractions, multiplications, or divisions. Formally, they have the form &lt;code>\(Y_t = (aY + b)\)&lt;/code>, where &lt;code>\(Y\)&lt;/code> is our original response variable of interest, &lt;code>\(a\)&lt;/code> and &lt;code>\(b\)&lt;/code> are any number (but &lt;code>\(a \ne 0\)&lt;/code>), and &lt;code>\(Y_t\)&lt;/code> is the transformed response. These transformations are called &amp;ldquo;linear&amp;rdquo; because the operations of addition, subtraction, multiplication and division only shift distributions left and right (addition and subtraction) or expand and shrink distributions (multiplication and division), so &lt;code>\(Y_t\)&lt;/code> and &lt;code>\(Y\)&lt;/code> follow a linear relationship for any finite and nonzero value of &lt;code>\(a\)&lt;/code> and any finite value of &lt;code>\(b\)&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Y&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">seq&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="m">0.01&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">1e-3&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nf">ggplot&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="nf">geom_line&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">aes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Y&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Y&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="m">10&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="m">3&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;img src="https://csc-ubc-okanagan.github.io/csc-data-blog/p/transforming-data/index.en_files/figure-html/unnamed-chunk-7-1.png" width="\linewidth" />
&lt;p>Conversely, nonlinear transformations are all transformations that cannot be written using only addition, subtraction, multiplications, or division. If we were to plot any of these functions, we would see a nonlinear relationship between the original and transformed values:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="nf">expand_grid&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Y&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">trans&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">c&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#39;Y / 10 + 3&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#39;log(Y)&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#39;sqrt(Y)&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s">&amp;#39;arcsin(sqrt(Y))&amp;#39;&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">mutate&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Y_star&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">case_when&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">trans&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#39;Y / 10 + 3&amp;#39;&lt;/span> &lt;span class="o">~&lt;/span> &lt;span class="n">Y&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="m">10&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="m">3&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">trans&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#39;log(Y)&amp;#39;&lt;/span> &lt;span class="o">~&lt;/span> &lt;span class="nf">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Y&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">trans&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#39;sqrt(Y)&amp;#39;&lt;/span> &lt;span class="o">~&lt;/span> &lt;span class="nf">sqrt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Y&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">trans&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#39;arcsin(sqrt(Y))&amp;#39;&lt;/span> &lt;span class="o">~&lt;/span> &lt;span class="nf">asin&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">sqrt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Y&lt;/span>&lt;span class="p">))))&lt;/span> &lt;span class="o">%&amp;gt;%&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">ggplot&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">aes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Y&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Y_star&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">facet_wrap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">~&lt;/span> &lt;span class="n">trans&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">scales&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;free_y&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">geom_line&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">labs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;Y&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">expression&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">bold&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Y[t]&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">## Warning: There was 1 warning in `mutate()`.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">##  In argument: `Y_star = case_when(...)`.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## Caused by warning in `asin()`:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">## ! NaNs produced
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;img src="https://csc-ubc-okanagan.github.io/csc-data-blog/p/transforming-data/index.en_files/figure-html/unnamed-chunk-8-1.png" width="\linewidth" />
&lt;h3 id="jensens-inequality">Jensen&amp;rsquo;s inequality
&lt;/h3>&lt;p>&lt;a class="link" href="https://en.wikipedia.org/wiki/Jensen%27s_inequality" target="_blank" rel="noopener"
>Jensen&amp;rsquo;s inequality&lt;/a> demostrates that if we apply a nonlinear transformation to a random variable, we can&amp;rsquo;t simply back-transform the mean. This is because, if &lt;code>\(g()\)&lt;/code> is a nonlinear transformation and &lt;code>\(g^{-1}()\)&lt;/code> is its inverse (e.g, &lt;code>\(g() = \log()\)&lt;/code> and &lt;code>\(g^{-1}()=\exp()\)&lt;/code>): &lt;code>$$g\big[\mathbb E(Y)\big] \ne \mathbb E\big[g(Y)\big],$$&lt;/code> where &lt;code>\(\mathbb E()\)&lt;/code> indicates an expected value such that &lt;code>\(\mathbb E(Y)=\mu\)&lt;/code>. This implies that &lt;code>$$\mathbb E(Y) = \mu \ne g^{-1}\bigg\{\mathbb E\big[g(Y)\big]\bigg\}.$$&lt;/code>&lt;/p>
&lt;p>Here is a graphical example to help you visualize why. The green vertical line is the estimated mean (i.e., what we&amp;rsquo;re usually interested in), the blue line is the estimated mean of the square-root transformed &lt;code>\(Y\)&lt;/code>, and the blue line is the back-transformed estimated mean of the square-root transformed &lt;code>\(Y\)&lt;/code>. The black line is the estimated bias.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-r" data-lang="r">&lt;span class="line">&lt;span class="cl">&lt;span class="nf">set.seed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="m">2024-10-7&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Y&lt;/span> &lt;span class="o">&amp;lt;-&lt;/span> &lt;span class="nf">rpois&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">n&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">250&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">lambda&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ggExtra&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="nf">ggMarginal&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">ggplot&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">geom_line&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">aes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">seq&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nf">ceiling&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">max&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Y&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="n">by&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">0.01&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">sqrt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">after_stat&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">))),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">color&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;grey&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">geom_jitter&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">aes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Y&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nf">sqrt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Y&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="n">height&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">0.02&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">alpha&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">0.3&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">geom_vline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">aes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">color&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;estimated~E(Y)&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">xintercept&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">mean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Y&lt;/span>&lt;span class="p">)),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lwd&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">geom_hline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">aes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">color&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;estimated~E(sqrt(Y))&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">yintercept&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">mean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">sqrt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Y&lt;/span>&lt;span class="p">))),&lt;/span> &lt;span class="n">lwd&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">geom_vline&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">aes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">color&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;estimated~(E(sqrt(Y)))^2&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">xintercept&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">mean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">sqrt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Y&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="n">^2&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">lwd&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">geom_segment&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">aes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">mean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">sqrt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Y&lt;/span>&lt;span class="p">))&lt;/span>&lt;span class="n">^2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">xend&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">mean&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Y&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">0.5&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">yend&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">0.5&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">arrow&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">grid&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="nf">arrow&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ends&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;both&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">length&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">unit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="m">0.1&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#39;in&amp;#39;&lt;/span>&lt;span class="p">)))&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">labs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">x&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;Y&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">expression&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">bold&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nf">sqrt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Y&lt;/span>&lt;span class="p">))))&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">khroma&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="nf">scale_color_bright&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;Variable&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">labels&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">scales&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="nf">parse_format&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="o">+&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nf">theme&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">legend.position&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;inside&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">legend.position.inside&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">c&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="m">0.8&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="m">0.2&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">legend.frame&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">element_rect&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fill&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;black&amp;#39;&lt;/span>&lt;span class="p">)),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">fill&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;grey&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">type&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s">&amp;#39;histogram&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">xparams&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">bins&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">5&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">yparams&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nf">list&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">bins&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="m">5&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;img src="https://csc-ubc-okanagan.github.io/csc-data-blog/p/transforming-data/index.en_files/figure-html/unnamed-chunk-9-1.png" width="\linewidth" />
&lt;p>However, note that the transformations only cause bias if applied to random variables. You can apply nonlinear transformations to predictor variables that you assume are measured exactly right. This means that fitting a model of the form &lt;code>\(Y = \beta_0 + \beta_1 \log(x_1)\)&lt;/code> will not cause issues if you assume &lt;code>\(x_1\)&lt;/code> is exactly correct with no error (as we often assume). Applying nonlinear transformations on predictors can be useful when a predictor has a distribution with a very long tail, or if one wants to create a variable with diminishing effects (e.g., moving closer to something matters more when you&amp;rsquo;re close and less when you&amp;rsquo;re already far from it). I will make a blog post on this in the future.&lt;/p>
&lt;h2 id="references">References
&lt;/h2>&lt;p>Whitlock M. &amp;amp; Schluter D. (2020). Analysis of biological data, Third edition. Macmillan Learning, New York, NY.&lt;/p></description></item><item><title>Getting started with GitHub</title><link>https://csc-ubc-okanagan.github.io/csc-data-blog/p/getting-started-with-github/</link><pubDate>Mon, 16 Sep 2024 12:00:00 -0800</pubDate><guid>https://csc-ubc-okanagan.github.io/csc-data-blog/p/getting-started-with-github/</guid><description>&lt;p>&lt;a class="link" href="https://github.com/" target="_blank" rel="noopener"
>GitHub&lt;/a> is a platform that allows you to store, share, and archive files. It is commonly used for in research to make files accessible, including code, data, models, and figures. Sharing code and data through platforms like GitHub helps make research more transparent, reproducible, and credible &lt;a class="link" href="https://doi.org/10.1111/2041-210X.14108" target="_blank" rel="noopener"
>Braga et al. 2023&lt;/a>. In this blog post, I will show you how to create your first GitHub repository (&amp;ldquo;repo&amp;rdquo; for short), how to set up a convenient folder structure, and how to push (i.e., upload) and pull (i.e., download) content to and from the repo. The &lt;a class="link" href="https://csc-ubc-okanagan.github.io/" target="_blank" rel="noopener"
>Center for Scholarly Communication&lt;/a> (CSC) also runs a two-part workshop on how to use GitHub. The material is available on the CSC website: &lt;a class="link" href="https://csc-ubc-okanagan.github.io/workshops/Intro-GitHub-Part-1.html" target="_blank" rel="noopener"
>Part 1&lt;/a> and &lt;a class="link" href="https://csc-ubc-okanagan.github.io/workshops/Intro-GitHub-Part-2.html" target="_blank" rel="noopener"
>Part 2&lt;/a>.&lt;/p>
&lt;p>Before we start, you will need to download and install &lt;a class="link" href="https://github.com/apps/desktop" target="_blank" rel="noopener"
>GitHub Desktop&lt;/a> from &lt;a class="link" href="https://desktop.github.com/download/" target="_blank" rel="noopener"
>https://desktop.github.com/download/&lt;/a>. While it installs, make an account on &lt;a class="link" href="github.com" >github.com&lt;/a> if you don&amp;rsquo;t have one already.&lt;/p>
&lt;p>To make your first repo, go to &lt;code>File/New repository&lt;/code> or press &lt;code>Ctrl + N&lt;/code>.&lt;/p>
&lt;p>&lt;img src="https://csc-ubc-okanagan.github.io/csc-data-blog/p/getting-started-with-github/images/new-repo.png"
width="666"
height="353"
srcset="https://csc-ubc-okanagan.github.io/csc-data-blog/p/getting-started-with-github/images/new-repo_hu_e7bf180219c2b1b7.png 480w, https://csc-ubc-okanagan.github.io/csc-data-blog/p/getting-started-with-github/images/new-repo_hu_8be83f90981c8645.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="188"
data-flex-basis="452px"
>&lt;/p>
&lt;p>Now choose your repo&amp;rsquo;s name. Something short and simple, like &lt;code>my-first-repo&lt;/code> works for now. If you want, you can also add a description of the repo&amp;rsquo;s contents and change the location of the local copy that GitHub Desktop will make. On my personal machine, I tend to save repos in &lt;code>Documents/GitHub&lt;/code>, but on my lab machine I save them in my UBC home drive: &lt;code>H:/GitHub&lt;/code>. If you are planning on working primarily with only one language (e.g., &lt;code>R&lt;/code> or &lt;code>Python&lt;/code>), I would suggest choosing the appropriate Git ignore. This will hide files that you generally don&amp;rsquo;t want to push to GitHub (e.g., &lt;code>.Rhistory&lt;/code> and &lt;code>.RData&lt;/code> files). You can change the &lt;code>.gitignore&lt;/code> files later with any text editor. The last step here is to choose a license. If you want a simple open-access licence for code, the MIT one is a good option.&lt;/p>
&lt;p>&lt;img src="https://csc-ubc-okanagan.github.io/csc-data-blog/p/getting-started-with-github/images/new-repo-options.png"
width="694"
height="780"
srcset="https://csc-ubc-okanagan.github.io/csc-data-blog/p/getting-started-with-github/images/new-repo-options_hu_c5e978ac49c939d9.png 480w, https://csc-ubc-okanagan.github.io/csc-data-blog/p/getting-started-with-github/images/new-repo-options_hu_4933a1ef0ab00513.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="88"
data-flex-basis="213px"
>&lt;/p>
&lt;p>You&amp;rsquo;ve now created your first GitHub repo, but it is currently only on your local machine. To push it to GitHub, you&amp;rsquo;ll need to publish the repo (top ribbon, to the right). Before confirming, you can:&lt;/p>
&lt;ol>
&lt;li>update the name (this won&amp;rsquo;t change the name of the folder on your machine),&lt;/li>
&lt;li>edit the description,&lt;/li>
&lt;li>decide whether you want the repo to be public or not (it&amp;rsquo;s private by default), and&lt;/li>
&lt;li>choose if you want to add it into an existing organization (e.g., your lab&amp;rsquo;s organization). Be careful though &amp;ndash; it can be hard to edit the repo after you&amp;rsquo;ve added it to an organization.&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://csc-ubc-okanagan.github.io/csc-data-blog/p/getting-started-with-github/images/publish-repo.png"
width="931"
height="338"
srcset="https://csc-ubc-okanagan.github.io/csc-data-blog/p/getting-started-with-github/images/publish-repo_hu_852574e63a2b85ca.png 480w, https://csc-ubc-okanagan.github.io/csc-data-blog/p/getting-started-with-github/images/publish-repo_hu_16c8450c10f4fa5c.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="275"
data-flex-basis="661px"
>&lt;/p>
&lt;p>Now that the repo is on GitHub, you can start pushing and pulling content to and from it. As a general rule, you should always check for any updates by pulling (click &lt;code>Fetch-origin&lt;/code> followed by &lt;code>Pull origin&lt;/code>) before trying to push anything, otherwise GitHub will have to manage the pull/push conflict by merging the old files (to be pulled) with the new ones (to be pushed). This can be quite confusing, so it&amp;rsquo;s always good to make to pull first (even if you&amp;rsquo;re the only one working on the repo on two machines). Once you have some files you want to push to the repo, select the ones you want to push by clicking on the boxes in the upper left, add a summary for the commit (i.e., the series of changes to push) at the bottom of the column. Commit summaries should be brief and simple but clear, like &amp;ldquo;cleaned data and started model fitting&amp;rdquo;. You can use markdown in both the summary and the description (see the field below the summary field) for messages like &amp;ldquo;removed unnecessary &lt;code>library()&lt;/code> calls&amp;rdquo; using $\text{&lt;code>text&lt;/code>}$. In the changes column, green &amp;ldquo;+&amp;rdquo; symbols indicate new files, yellow dots indicate changed files, and red &amp;ldquo;-&amp;rdquo; symbols indicate file deletions. The panel on the right will show you exactly what portions of a file you changed, if the file is a simple text file (e.g., &lt;code>.csv.&lt;/code>, &lt;code>.R&lt;/code>, &lt;code>.Rmd&lt;/code>, &lt;code>.md&lt;/code>, and &lt;code>.txt&lt;/code>, but not &lt;code>.pdf&lt;/code>, &lt;code>.doc&lt;/code>, &lt;code>.ppt&lt;/code>, or &lt;code>.rds&lt;/code>). Consequently, GitHub&amp;rsquo;s version control and edit history work best if you use simple text files as much as possible. Once you&amp;rsquo;ve committed all your changes, don&amp;rsquo;t forget to push the changes to GitHub using the &amp;ldquo;Push origin&amp;rdquo; button! You can check the status of your changes by going to &lt;a class="link" href="https://github.com/" target="_blank" rel="noopener"
>GitHub&lt;/a> and navigating to your repo.&lt;/p>
&lt;p>&lt;img src="https://csc-ubc-okanagan.github.io/csc-data-blog/p/getting-started-with-github/images/push-origin.png"
width="618"
height="120"
srcset="https://csc-ubc-okanagan.github.io/csc-data-blog/p/getting-started-with-github/images/push-origin_hu_2dd72d951c8e876b.png 480w, https://csc-ubc-okanagan.github.io/csc-data-blog/p/getting-started-with-github/images/push-origin_hu_a0ebeceb741af2e6.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="515"
data-flex-basis="1236px"
>&lt;/p>
&lt;h1 id="references">References
&lt;/h1>&lt;p>Braga P.H.P., Hbert K., Hudgins E.J., Scott E.R., Edwards B.P.M., Snchez Reyes L.L., et al. (2023). Not just for programmers: How GitHub can accelerate collaborative and reproducible research in ecology and evolution. Methods in Ecology and Evolution 14, 13641380. &lt;a class="link" href="https://doi.org/10.1111/2041-210X.14108" target="_blank" rel="noopener"
>https://doi.org/10.1111/2041-210X.14108&lt;/a>&lt;/p></description></item><item><title>Using Python in RStudio with Reticulate Package</title><link>https://csc-ubc-okanagan.github.io/csc-data-blog/p/using-python-in-rstudio-with-reticulate-package/</link><pubDate>Wed, 26 Jul 2023 09:00:00 -0800</pubDate><guid>https://csc-ubc-okanagan.github.io/csc-data-blog/p/using-python-in-rstudio-with-reticulate-package/</guid><description>&lt;p>As we know, Jupyter Notebook can be used easily with our UBC login information via &lt;a class="link" href="https://ubc.syzygy.ca/" target="_blank" rel="noopener"
>Syzygy&lt;/a>. Jupyter Notebook can also be downloaded to a computer and used via Anaconda. There are many different interfaces that allow us to use Python. One of the more interesting ones to note is actually RStudio. There is a package in R called &lt;em>reticulate&lt;/em> that allows us to create an RMarkdown file and use both R and Python code chunks within the same file. This is actually how this blog is able to show both R and Python content! Let&amp;rsquo;s get started on how &lt;em>reticulate&lt;/em> is used in RStudio to include Python code.&lt;/p>
&lt;h2 id="installation">Installation
&lt;/h2>&lt;p>First, installation is required. To install the reticulate package in RStudio from CRAN, type the following:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">install.packages(&amp;#34;reticulate&amp;#34;)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="python-version">Python Version
&lt;/h2>&lt;p>Next, we need to access the version of Python desired. Reticulate will, by default, find and use the version of Python via &lt;code>PATH&lt;/code>. To check this, type &lt;code>Sys.which(&amp;quot;python&amp;quot;)&lt;/code>.&lt;/p>
&lt;p>If you would like to change the version to something other than what is found in &lt;code>PATH&lt;/code>, try the &lt;code>use_python()&lt;/code> function. Here is an example of how to call the package from the library, and then use a different path to get to the desired Python version.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">library(reticulate)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">use_python(&amp;#34;/my/file/path/python&amp;#34;)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="getting-started">Getting Started
&lt;/h1>&lt;p>Now that the &lt;em>reticulate&lt;/em> package has been installed, we can start using Python within an RMarkdown document.&lt;/p>
&lt;p>Once an RMarkdown file has been started, create a new code block. Note that on a Windows, a shortcut for adding a new code block is Ctrl+alt+i. Once a new code block appears, it should look like this:&lt;/p>
&lt;p>&lt;img src="https://csc-ubc-okanagan.github.io/csc-data-blog/p/using-python-in-rstudio-with-reticulate-package/images/r-code-chunk.png"
width="361"
height="67"
srcset="https://csc-ubc-okanagan.github.io/csc-data-blog/p/using-python-in-rstudio-with-reticulate-package/images/r-code-chunk_hu_55df813411c7ca7d.png 480w, https://csc-ubc-okanagan.github.io/csc-data-blog/p/using-python-in-rstudio-with-reticulate-package/images/r-code-chunk_hu_5228893c6b3302d3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="538"
data-flex-basis="1293px"
>&lt;/p>
&lt;p>If you were to type code here, it would be in R. To change it to Python, simply replace the &amp;lsquo;r&amp;rsquo; with &amp;lsquo;python&amp;rsquo;. Then it will look like this:&lt;/p>
&lt;p>&lt;img src="https://csc-ubc-okanagan.github.io/csc-data-blog/p/using-python-in-rstudio-with-reticulate-package/images/python-code-chunk.png"
width="409"
height="58"
srcset="https://csc-ubc-okanagan.github.io/csc-data-blog/p/using-python-in-rstudio-with-reticulate-package/images/python-code-chunk_hu_508e35ab1fa9cd94.png 480w, https://csc-ubc-okanagan.github.io/csc-data-blog/p/using-python-in-rstudio-with-reticulate-package/images/python-code-chunk_hu_2b4b2d620ffa2ed9.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="705"
data-flex-basis="1692px"
>&lt;/p>
&lt;p>Now, the console below will change to show Python code once something in this block is run. You can easily switch back and forth between R and Python from code chunk to code chunk.&lt;/p>
&lt;p>You can also see your saved variables in the environment, separated between R and Python. Note that when you do something such as import a dataset, if you wanted to perform manipulations on the dataset in both R and Python, you will have to load the dataset in using both R and Python, and it will create separate variables which do not override each other. They will stay speparate in the environment.&lt;/p>
&lt;p>To change between R and Python environments, go to the Environment window and click the dropdown arrow. It should look like this:&lt;/p>
&lt;p>&lt;img src="https://csc-ubc-okanagan.github.io/csc-data-blog/p/using-python-in-rstudio-with-reticulate-package/images/environment.png"
width="654"
height="597"
srcset="https://csc-ubc-okanagan.github.io/csc-data-blog/p/using-python-in-rstudio-with-reticulate-package/images/environment_hu_3946c20166b342e6.png 480w, https://csc-ubc-okanagan.github.io/csc-data-blog/p/using-python-in-rstudio-with-reticulate-package/images/environment_hu_9bf021c240f0f6a9.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="109"
data-flex-basis="262px"
>&lt;/p>
&lt;p>If you would like to see some examples, take a look at the &lt;code>_src&lt;/code> folder in the GitHub repo for this blog to see how each of the posts are created in both R and Python. The link to the backend content for this blog can be found &lt;a class="link" href="https://github.com/csc-ubc-okanagan/R-Python-Blog" target="_blank" rel="noopener"
>here&lt;/a>.&lt;/p></description></item><item><title>Changing the RStudio Theme</title><link>https://csc-ubc-okanagan.github.io/csc-data-blog/p/changing-the-rstudio-theme/</link><pubDate>Sat, 11 Feb 2023 09:00:00 -0800</pubDate><guid>https://csc-ubc-okanagan.github.io/csc-data-blog/p/changing-the-rstudio-theme/</guid><description>&lt;p>Color schemes are a matter of preference, but I think many of us can agree that RStudio&amp;rsquo;s default theme is quite bright and low-contrast. Fortunately, RStudio offers some alternative themes, which you can see by clicking on &lt;code>Tools &amp;gt; Global Options&lt;/code> in the top ribbon menu in RStudio. You can then select &lt;code>Appearance&lt;/code> and change the Editor theme.&lt;/p>
&lt;p>Of the default themes, the Cobalt theme is my preferred one, but I find some of the colors to be too similar (such as the white for general text and the light blue used for headings in &lt;code>R&lt;/code> Markdown documents). You can find the custom theme I use &lt;a class="link" href="https://github.com/StefanoMezzini/misc/blob/main/Black%20Rmd.rstheme" target="_blank" rel="noopener"
>on my GitHub page&lt;/a>. To add use this theme, go to &lt;code>Tools &amp;gt; Global Options&lt;/code>, then select &lt;code>Appearance&lt;/code>, and click on &lt;code>Add&lt;/code>. Finally, select the &lt;code>Black Rmd.rstheme&lt;/code> file, and click on &lt;code>Open&lt;/code>.&lt;/p>
&lt;p>&lt;img src="https://csc-ubc-okanagan.github.io/csc-data-blog/p/changing-the-rstudio-theme/images/dark-theme-example.png"
width="3840"
height="2160"
srcset="https://csc-ubc-okanagan.github.io/csc-data-blog/p/changing-the-rstudio-theme/images/dark-theme-example_hu_2c0157ae4fbf88ed.png 480w, https://csc-ubc-okanagan.github.io/csc-data-blog/p/changing-the-rstudio-theme/images/dark-theme-example_hu_565393bd374aed2e.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="177"
data-flex-basis="426px"
>&lt;/p></description></item></channel></rss>